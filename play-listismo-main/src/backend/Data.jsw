import wixData from 'wix-data';

$w.onReady(function () {
    // FunÃ§Ã£o para atualizar os crÃ©ditos
    function updateCredits(videoId) {
        wixData.query("playlist1014FULL_vr1")
            .eq("ytID", ytID)
            .find()
            .then((results) => {
                if (results.items.length > 0) {
                    let item = results.items[0];
                    $w("#artista").text = `ðŸŽ¤ ${item.artista}`;
                    $w("#songTitle").text = `ðŸŽ¶ ${item.songTitle}`;
                    $w("#album").text = `ðŸ’¿ ${item.album}`;
                    $w("#year").text = `ðŸ“… ${item.year}`;
                    $w("#director").text = `ðŸŽ¬ï¸Ž ${item.director}`;
                } else {
                    $w("#artista").text = `ðŸŽ¤ artista`;
                    $w("#songTitle").text = `ðŸŽ¶ songTitle`;
                    $w("#album").text = `ðŸ’¿ album`;
                    $w("#year").text = `ðŸ“… year`;
                    $w("#director").text = `ðŸŽ¬ï¸Ž director`;
                }
            })
            .catch((err) => {
                console.log(err);
            });
    }

    // FunÃ§Ã£o para inicializar o player do YouTube e monitorar mudanÃ§as de vÃ­deo
    function initYouTubePlayer() {
        let player;
        // CÃ³digo para inicializar o player do YouTube
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                let videoId = player.getVideoData().video_id;
                updateCredits(videoId);
            }
        }

        // Configurar o player do YouTube
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // Carregar a API do YouTube
        if (!window.YT) {
            let tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            let firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
        } else {
            onYouTubeIframeAPIReady();
        }
    }

    // Inicializa o player do YouTube ao carregar a pÃ¡gina
    initYouTubePlayer();
});
/*********
 .jsw file
 *********

 Backend .jsw files contain functions that run on the server side but can be called from page code and frontend files.
 Use backend functions to keep code private and hidden from a user's browser. More info:

 https://support.wix.com/en/article/velo-web-modules-calling-backend-code-from-the-frontend

**********/

/*** Call the sample multiply function below by copying the following into your page code:

 import { multiply } from 'backend/multiplication';

 $w.onReady(function () {
     multiply(4, 5).then(product => {
         console.log(product);
     })
     .catch(error => {
         console.log(error);
     });
 });

***/

// Sample backend code in a multiplication.jsw file:

export function multiply(factor1, factor2) {
   return factor1 * factor2;
}