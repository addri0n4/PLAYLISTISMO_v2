import {getsecret} from 'wix-secrets-backends';
import wixFetch from "wix-fetch";

export const getApiKey = async(AIzaSyBJtfXD2LMIMq5nnAxE9fwovWUzS5RJ5wI) =>{
    const privateKey = await getsecret ('YouTubeAPI');
    console.log (privateKey)
}

export const getvideosID = async() =>{
    const response = await fetch(https://www.youtube.com/playlist?list=PLEsPxCgw-KMfSKG_teViyO1iFMhVc8nWB)

import wixData from 'wix-data';

$w.onReady(function () {
    // Inicializa o player do YouTube
    initYouTubePlayer($w('#player1'));

    // Fun√ß√£o para atualizar os cr√©ditos
    function updateCredits(ytID) {
        wixData.query("playlist1014FULL_vr1")
            .eq("ytID", ytID)
            .find()
            .then((results) => {
                if (results.items.length > 0) {
                    let item = results.items[0];
                    $w("#artista").text = `üé§ ${item.artista}`;
                    $w("#songTitle").text = `üé∂ ${item.songTitle}`;
                    $w("#album").text = `üíø ${item.album}`;
                    $w("#year").text = `üìÖ ${item.year}`;
                    $w("#director").text = `üé¨Ô∏é ${item.director}`;
                    $w("#creditBox").show();
                } else {
                    $w("#artista").text = `üé§ artista`;
                    $w("#songTitle").text = `üé∂ songTitle`;
                    $w("#album").text = `üíø album`;
                    $w("#year").text = `üìÖ year`;
                    $w("#director").text = `üé¨Ô∏é director`;
                    $w("#creditBox").show();
                }
            })
            .catch((err) => {
                console.log(err);
            });
    }

    // Fun√ß√£o para inicializar o player do YouTube e monitorar mudan√ßas de v√≠deo
    function initYouTubePlayer(#player1) {
        let player1;
        // C√≥digo para inicializar o player do YouTube
        // Substitua pelo seu pr√≥prio c√≥digo de inicializa√ß√£o do player

        // Exemplo de fun√ß√£o de callback quando o estado do player muda
        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                let videoId = player.getVideoData(ytID).ytID;
                updateCredits(ytID);

                // Exibir cr√©ditos no in√≠cio do v√≠deo
                setTimeout(() => {
                    $w("#creditBox").show("fade", { duration: 1000 });
                    setTimeout(() => $w("#creditBox").hide("fade", { duration: 1000 }), 15000);
                }, 10000);

                // Exibir cr√©ditos no final do v√≠deo
                let remainingTime = player.getDuration() - player.getCurrentTime();
                if (remainingTime > 30) {
                    setTimeout(() => {
                        $w("#creditBox").show("fade", { duration: 1000 });
                        setTimeout(() => $w("#creditBox").hide("fade", { duration: 1000 }), 15000);
                    }, remainingTime - 30000);
                }
            }
        }

        // Fun√ß√£o para configurar o player do YouTube
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player1', {
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // Certifique-se de carregar a API do YouTube
        if (!window.YT) {
            let tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            let firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
        } else {
            onYouTubeIframeAPIReady();
        }
    }

    // Inicializa o player do YouTube ao carregar a p√°gina
    initYouTubePlayer();
});



</div>

<div id="creditBox">
  <div id="artista"></div>
  <div id="songTitle"></div>
  <div id="album"></div>
  <div id="year"></div>
  <div id="director"></div>
</div>

import wixData from 'wix-data';
import { getCurrentVideoId, initYouTubePlayer } from 'public/youtubePlayerAPI.js';

$w.onReady(function () {
    let player = $w("#player");
    let creditBox = $w("#creditBox");

    // Inicializa o player do YouTube
    initYouTubePlayer(player);

    // Fun√ß√£o para atualizar os cr√©ditos
    function updateCredits(videoId) {
        wixData.query("playlist1014FULL_vr1")
            .eq("videoId", videoId)
            .find()
            .then((results) => {
                if (results.items.length > 0) {
                    let item = results.items[0];
                    $w("#artista").text = `üé§ ${item.artista}`;
                    $w("#songTitle").text = `üé∂ ${item.songTitle}`;
                    $w("#album").text = `üíø ${item.album}`;
                    $w("#year").text = `üìÖ ${item.year}`;
                    $w("#director").text = `üé¨Ô∏é ${item.director}`;
                    creditBox.show();
                } else {
                    $w("#artista").text = `üé§ artista`;
                    $w("#songTitle").text = `üé∂ songTitle`;
                    $w("#album").text = `üíø album`;
                    $w("#year").text = `üìÖ year`;
                    $w("#director").text = `üé¨Ô∏é director`;
                    creditBox.show();
                }
            })
            .catch((err) => {
                console.log(err);
            });
    }

    // Monitorar o player do YouTube para mudan√ßas de v√≠deo
    player.on("stateChange", (event) => {
        if (event.data === 1) { // 1 = PLAYING
            let videoId = getCurrentVideoId(player);
            updateCredits(videoId);

            // Agendar exibi√ß√£o inicial dos cr√©ditos
            setTimeout(() => {
                creditBox.show("fade", { duration: 1000 });
                setTimeout(() => creditBox.hide("fade", { duration: 1000 }), 15000);
            }, 10000);

            // Agendar exibi√ß√£o final dos cr√©ditos
            let remainingTime = player.getDuration() - player.getCurrentTime();
            if (remainingTime > 30) {
                setTimeout(() => {
                    creditBox.show("fade", { duration: 1000 });
                    setTimeout(() => creditBox.hide("fade", { duration: 1000 }), 15000);
                }, remainingTime - 30000);
            }
        }
    });
});

/*********
 .jsw file
 *********

 Backend .jsw files contain functions that run on the server side but can be called from page code and frontend files.
 Use backend functions to keep code private and hidden from a user's browser. More info:

 https://support.wix.com/en/article/velo-web-modules-calling-backend-code-from-the-frontend

**********/

/*** Call the sample multiply function below by copying the following into your page code:

 import { multiply } from 'backend/multiplication';

 $w.onReady(function () {
     multiply(4, 5).then(product => {
         console.log(product);
     })
     .catch(error => {
         console.log(error);
     });
 });

***/

// Sample backend code in a multiplication.jsw file:

export function multiply(factor1, factor2) {
   return factor1 * factor2;
}